### 零拷贝

##### 数据拷贝

- 传统的Linux系统标准I/O接口基于数据拷贝。即I/O操作会导致数据在操作系统内核地址空间的缓冲区和应用程序地址空间定义的缓冲区之间进行传输。好处是减少了磁盘的I/O操作，但是数据拷贝会占用很多CPU时间。

##### 零拷贝

- 零拷贝是一种避免使用CPU将数据从一块存储拷贝到另外一块存储的技术(并不是不拷贝数据)。一方面，它可以减少数据拷贝和共享总线操作的次数；另一方面，也减少了应用程序地址空间和内核地址空间之间上下文切换带来的开销。

##### 零拷贝原理

- mmap
  - 使用mmap代替read调用，磁盘的数据通过DMA拷贝到内核缓冲区，并且在内核缓冲区与应用程序之间共享；然后应用程序再调用write函数，将数据写入socket套接字中。这种方法可以避免数据在内核与应用程序之间拷贝
- sendfile(linux kernel 2.1)
  - sendfile可以将一个输入文件直接copy到一个socket套接字中，所有操作都发生在内核态。不仅减少了数据拷贝次数，还减少了上下文切换
- splice(linux kernel  2.6.17)
  - splice支持在两个文件描述符中移动数据，而不需要在内核空间和用户空间来回拷贝
- COW（写时复制）
  - 当数据必须在用户空间和内核空间之间拷贝时，采用这种方式。如果多个程序同时访问同一块数据，那么每个程序都拥有指向这块数据的指针，在每个程序看来，自己都是独立拥有这块数据的，只有当程序需要对数据内容进行修改时，才会把数据内容拷贝到程序自己的应用空间里去，这时候，数据才成为该程序的私有数据。

### Fork